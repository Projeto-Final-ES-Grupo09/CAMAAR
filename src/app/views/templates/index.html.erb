<div class="container-template">
  <% if @templates.any? %>
    <% @templates.each do |template| %>
      <div class="box-template">
        <div class="info-template">
          <h1><%= template.nome %></h1>
          <p>Semestre: <%= template.semestre %></p>
        </div>
        <div class="icon-template">
          <%= image_tag('editarIcon.png', alt: 'Editar', class: 'icon-menu', id: 'openModalEdit') %>
          <%= image_tag('lixeiraIcon.png', alt: 'Deletar', class: 'icon-menu openModalDelete', data: { id: template.id }) %>
        </div>
      </div>
    <% end %>
  <% else %>
    <p>Nenhum template encontrado.</p>
  <% end %>
  <div class="adicionar-template" id="openModalAdd">
    +
  </div>
</div>

<div id="modalDelete" class="modal-adicionar-template">
  <div class="modal-content">
    <p>Você tem certeza que deseja deletar este template?</p>
    <%= form_with url: "", method: :delete, id: "deleteForm" do %>
      <%= hidden_field_tag :template_id %>
      <button type="submit">Confirmar</button>
    <% end %>
    <button id="cancelDelete">Cancelar</button>
  </div>
</div>

 <div class="modal-adicionar-template" id="template-add">
 <div class="modal-content">
    <%= form_with(model: @template, url: templates_path, local: true, id: "formNovoTemplate", class: "template-form") do |form| %>
    <div class="headerTemplateAdd">  
      <label for="tname">
        Nome do template:
      </label>
      <input type="text" id="tname" name="tname"><br><br>
      <label for="tsemestre">Semestre:
        <input type="number" id="tsemestre" name="tsemestre"><br><br>
      </label>
    </div>  
    <% end %>
   <%= render partial: "questaoSelect" %>
 </div>
</div>

<div id="modalEdicao" class="modal-adicionar-template">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2>Editar Template</h2>
    <form id="formEdicao">
      <label for="editCodigo">Código:</label>
      <input type="text" id="editCodigo" name="editCodigo" required>

      <label for="editNome">Nome:</label>
      <input type="text" id="editNome" name="editNome" required>

      <label for="editSemestre">Semestre:</label>
      <input type="text" id="editSemestre" name="editSemestre" required>

      <button type="submit">Salvar</button>
    </form>
  </div>
</div>

<script>
  var modal = document.getElementById("template-add");
  var modalEdit = document.getElementById("modalEdicao");
  var btn = document.getElementById("openModalAdd");
  var btnEdit = document.getElementById("openModalEdit");
  const openModalDeleteButtons = document.querySelectorAll('.openModalDelete');
  const modalDelete = document.getElementById('modalDelete');
  const deleteForm = document.getElementById('deleteForm');
  let deleteTemplateId = null;

  // Abrir modal de adição
  btn.onclick = function() {
    modal.style.display = "block";
  };

  // Abrir modal de edição
  btnEdit.onclick = function() {
    modalEdit.style.display = "block";
  };

  // Fechar modais ao clicar fora deles
  window.onclick = function(event) {
    if (event.target == modal) {
      modal.style.display = "none";
    }
    if (event.target == modalEdit) {
      modalEdit.style.display = "none";
    }
    if (event.target == modalDelete) {
      modalDelete.style.display = "none";
    }
  };

  openModalDeleteButtons.forEach(button => {
    button.addEventListener('click', () => {
      deleteTemplateId = button.dataset.id;
      modalDelete.style.display = 'block';
      deleteForm.action = `/templates/${deleteTemplateId}`;
    });
  });

  document.getElementById('cancelDelete').addEventListener('click', () => {
    modalDelete.style.display = 'none';
    deleteTemplateId = null;
  });
</script>
